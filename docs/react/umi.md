---
sidebarDepth: 1
---
# UmiJS
> è¯¥éƒ¨åˆ†ç¬”è®°æ‘˜æŠ„äº[UmiJSå®˜ç½‘](https://umijs.org/zh/)ï¼Œè®°å½•å…¶ä¸­å¸¸ç”¨éƒ¨åˆ†ï¼Œå…¶ä½™å…·ä½“è¯·æŸ¥é˜…å®˜ç½‘ã€‚

umiï¼Œä¸­æ–‡å¯å‘éŸ³ä¸ºä¹Œç±³ï¼Œæ˜¯ä¸€ä¸ªå¯æ’æ‹”çš„ä¼ä¸šçº§ react åº”ç”¨æ¡†æ¶ã€‚umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼Œæ”¯æŒç±» next.js çš„çº¦å®šå¼è·¯ç”±ï¼Œä»¥åŠå„ç§è¿›é˜¶çš„è·¯ç”±åŠŸèƒ½ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œæ¯”å¦‚æ”¯æŒè·¯ç”±çº§çš„æŒ‰éœ€åŠ è½½ã€‚ç„¶åé…ä»¥å®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ï¼Œç›®å‰å†…å¤–éƒ¨åŠ èµ·æ¥å·²æœ‰ 50+ çš„æ’ä»¶ã€‚

umi æ˜¯èš‚èšé‡‘æœçš„åº•å±‚å‰ç«¯æ¡†æ¶ï¼Œå·²ç›´æ¥æˆ–é—´æ¥åœ°æœåŠ¡äº† 600+ åº”ç”¨ï¼ŒåŒ…æ‹¬ javaã€nodeã€H5 æ— çº¿ã€ç¦»çº¿ï¼ˆHybridï¼‰åº”ç”¨ã€çº¯å‰ç«¯ assets åº”ç”¨ã€CMS åº”ç”¨ç­‰ã€‚ä»–å·²ç»å¾ˆå¥½åœ°æœåŠ¡äº†æˆ‘ä»¬çš„å†…éƒ¨ç”¨æˆ·ï¼ŒåŒæ—¶å¸Œæœ›ä»–ä¹Ÿèƒ½æœåŠ¡å¥½å¤–éƒ¨ç”¨æˆ·ã€‚

ç‰¹æ€§
``` sh
ğŸ“¦ å¼€ç®±å³ç”¨ï¼Œå†…ç½® reactã€react-router ç­‰  
ğŸˆ ç±» next.js ä¸”åŠŸèƒ½å®Œå¤‡çš„è·¯ç”±çº¦å®šï¼ŒåŒæ—¶æ”¯æŒé…ç½®çš„è·¯ç”±æ–¹å¼  
ğŸ‰ å®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸ  
ğŸš€ é«˜æ€§èƒ½ï¼Œé€šè¿‡æ’ä»¶æ”¯æŒ PWAã€ä»¥è·¯ç”±ä¸ºå•å…ƒçš„ code splitting ç­‰  
ğŸ’ˆ æ”¯æŒé™æ€é¡µé¢å¯¼å‡ºï¼Œé€‚é…å„ç§ç¯å¢ƒï¼Œæ¯”å¦‚ä¸­å°ä¸šåŠ¡ã€æ— çº¿ä¸šåŠ¡ã€eggã€æ”¯ä»˜å®é’±åŒ…ã€äº‘å‡¤è¶ç­‰  
ğŸš„ å¼€å‘å¯åŠ¨å¿«ï¼Œæ”¯æŒä¸€é”®å¼€å¯ dll ç­‰  
ğŸ  ä¸€é”®å…¼å®¹åˆ° IE9ï¼ŒåŸºäº umi-plugin-polyfills  
ğŸ å®Œå–„çš„ TypeScript æ”¯æŒï¼ŒåŒ…æ‹¬ d.ts å®šä¹‰å’Œ umi test  
ğŸŒ´ ä¸ dva æ•°æ®æµçš„æ·±å…¥èåˆï¼Œæ”¯æŒ duck directoryã€model çš„è‡ªåŠ¨åŠ è½½ã€code splitting ç­‰ç­‰
```

## ç›®å½•åŠçº¦å®š
``` js
.
â”œâ”€â”€ dist/                          // é»˜è®¤çš„ build è¾“å‡ºç›®å½•
â”œâ”€â”€ mock/                          // mock æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼ŒåŸºäº express
â”œâ”€â”€ config/
    â”œâ”€â”€ config.js                  // umi é…ç½®ï¼ŒåŒ .umirc.jsï¼ŒäºŒé€‰ä¸€
â””â”€â”€ src/                           // æºç ç›®å½•ï¼Œå¯é€‰
    â”œâ”€â”€ layouts/index.js           // å…¨å±€å¸ƒå±€
    â”œâ”€â”€ pages/                     // é¡µé¢ç›®å½•ï¼Œé‡Œé¢çš„æ–‡ä»¶å³è·¯ç”±
        â”œâ”€â”€ .umi/                  // dev ä¸´æ—¶ç›®å½•ï¼Œéœ€æ·»åŠ åˆ° .gitignore
        â”œâ”€â”€ .umi-production/       // build ä¸´æ—¶ç›®å½•ï¼Œä¼šè‡ªåŠ¨åˆ é™¤
        â”œâ”€â”€ document.ejs           // HTML æ¨¡æ¿
        â”œâ”€â”€ 404.js                 // 404 é¡µé¢
        â”œâ”€â”€ page1.js               // é¡µé¢ 1ï¼Œä»»æ„å‘½åï¼Œå¯¼å‡º react ç»„ä»¶
        â”œâ”€â”€ page1.test.js          // ç”¨ä¾‹æ–‡ä»¶ï¼Œumi test ä¼šåŒ¹é…æ‰€æœ‰ .test.js å’Œ .e2e.js ç»“å°¾çš„æ–‡ä»¶
        â””â”€â”€ page2.js               // é¡µé¢ 2ï¼Œä»»æ„å‘½å
    â”œâ”€â”€ global.css                 // çº¦å®šçš„å…¨å±€æ ·å¼æ–‡ä»¶ï¼Œè‡ªåŠ¨å¼•å…¥ï¼Œä¹Ÿå¯ä»¥ç”¨ global.less
    â”œâ”€â”€ global.js                  // å¯ä»¥åœ¨è¿™é‡ŒåŠ å…¥ polyfill
    â”œâ”€â”€ app.js                     // è¿è¡Œæ—¶é…ç½®æ–‡ä»¶
â”œâ”€â”€ .umirc.js                      // umi é…ç½®ï¼ŒåŒ config/config.jsï¼ŒäºŒé€‰ä¸€
â”œâ”€â”€ .env                           // ç¯å¢ƒå˜é‡
â””â”€â”€ package.json
```
### mock
æ­¤ç›®å½•ä¸‹æ‰€æœ‰çš„ .js æ–‡ä»¶ï¼ˆåŒ…æ‹¬ _ å‰ç¼€çš„ï¼‰éƒ½ä¼šè¢«è§£æä¸º mock æ–‡ä»¶ã€‚

æ¯”å¦‚ï¼Œæ–°å»º mock/users.jsï¼Œå†…å®¹å¦‚ä¸‹ï¼š
``` js
export default {
  '/api/users': ['a', 'b'],
};
```
ç„¶ååœ¨æµè§ˆå™¨é‡Œè®¿é—® http://localhost:8000/api/users å°±å¯ä»¥çœ‹åˆ° ['a', 'b'] äº†ã€‚

å¦‚æœæƒ³å¿½ç•¥ mock æ–‡ä»¶å¤¹ä¸‹çš„éƒ¨åˆ†æ–‡ä»¶ï¼Œæ’é™¤ mock ç›®å½•ä¸‹ä¸ä½œ mock å¤„ç†çš„æ–‡ä»¶ï¼Œåˆ™åœ¨.umirc.jsæˆ–config/config.jsä¸­è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹ï¼š
``` js
export default {
  mock: {
    exclude: ['mock/**/_*.js', 'mock/_*/**/*.js'],
  },
};
```
### src/layouts/index.js
æ³¨ï¼šé…ç½®å¼è·¯ç”±ä¸‹æ— æ•ˆã€‚

å…¨å±€å¸ƒå±€ï¼Œåœ¨è·¯ç”±å¤–é¢å¥—çš„ä¸€å±‚è·¯ç”±ã€‚

æ¯”å¦‚ï¼Œä½ çš„è·¯ç”±æ˜¯ï¼š
``` js
[
  { path: '/', component: './pages/index' },
  { path: '/users', component: './pages/users' },
]
```
å¦‚æœæœ‰ layouts/index.jsï¼Œé‚£ä¹ˆè·¯ç”±å°±ä¼šå˜ä¸ºï¼š
``` js
[
  {
    path: '/',
    component:'./layouts/index',
    routes: [
        { path: '/', component: './pages/index' },
        { path: '/users', component: './pages/users' },
    ] 
  }
]
```
### src/pages/.umi
è¿™æ˜¯ umi dev æ—¶ç”Ÿäº§çš„ä¸´æ—¶ç›®å½•ï¼Œé»˜è®¤åŒ…å« umi.js å’Œ router.jsï¼Œæœ‰äº›æ’ä»¶ä¹Ÿä¼šåœ¨è¿™é‡Œç”Ÿæˆä¸€äº›å…¶ä»–ä¸´æ—¶æ–‡ä»¶ã€‚å¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›éªŒè¯ï¼Œä½†è¯·ä¸è¦ç›´æ¥åœ¨è¿™é‡Œä¿®æ”¹ä»£ç ï¼Œumi é‡å¯æˆ–è€… pages ä¸‹çš„æ–‡ä»¶ä¿®æ”¹éƒ½ä¼šé‡æ–°ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ã€‚
### é…ç½®æ–‡ä»¶
.umirc.(js|ts) å’Œ config/config.(js|ts) ç¼–è¯‘æ—¶é…ç½®æ–‡ä»¶ï¼ŒäºŒé€‰ä¸€ï¼Œä¸å¯å…±å­˜ã€‚

### .env
ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼š
``` js
CLEAR_CONSOLE=none
BROWSER=none // åˆ é™¤è¯¥è¡Œï¼Œå¯åŠ¨é¡¹ç›®æ—¶ä¼šæ‰“å¼€é»˜è®¤æµè§ˆå™¨
```
è¿™é‡Œå®šä¹‰çš„ç³»ç»Ÿç¯å¢ƒå˜é‡åœ¨æ•´ä¸ªumi-build-devçš„ç”Ÿå‘½å‘¨æœŸé‡Œéƒ½å¯ä»¥è¢«ä½¿ç”¨

## çº¦å®šå¼è·¯ç”±
å‡è®¾ pages ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š
``` js
+ pages/
  + users/
    - index.js
    - list.js
  - index.js
```
é‚£ä¹ˆï¼Œumi ä¼šè‡ªåŠ¨ç”Ÿæˆè·¯ç”±é…ç½®å¦‚ä¸‹ï¼š
``` js
[
  { path: '/', component: './pages/index.js' },
  { path: '/users/', component: './pages/users/index.js' },
  { path: '/users/list', component: './pages/users/list.js' },
]
```
::: danger æ³¨æ„
è‹¥ .umirc.(ts|js) æˆ– config/config.(ts|js) æ–‡ä»¶ä¸­å¯¹ router è¿›è¡Œäº†é…ç½®ï¼Œçº¦å®šå¼è·¯ç”±å°†å¤±æ•ˆã€æ–°æ·»çš„é¡µé¢ä¸ä¼šè‡ªåŠ¨è¢« umi ç¼–è¯‘ï¼Œumi å°†ä½¿ç”¨é…ç½®å¼è·¯ç”±ã€‚(å³æ–‡ä»¶ä¸­ä¸èƒ½åŒ…å«routeså±æ€§)
:::

## é…ç½®å¼è·¯ç”±
å¦‚æœä½ å€¾å‘äºä½¿ç”¨é…ç½®å¼çš„è·¯ç”±ï¼Œå¯ä»¥é…ç½® .umirc.(ts|js) æˆ–è€… config/config.(ts|js) é…ç½®æ–‡ä»¶ä¸­çš„ routes å±æ€§ï¼Œ**æ­¤é…ç½®é¡¹å­˜åœ¨æ—¶åˆ™ä¸ä¼šå¯¹ src/pages ç›®å½•åšçº¦å®šå¼çš„è§£æã€‚**

æ¯”å¦‚ï¼š
``` js
export default {
  routes: [
    { path: '/', component: './a' },
    { path: '/list', component: './b', Routes: ['./routes/PrivateRoute.js'] },
    { path: '/users', component: './users/_layout',
      routes: [
        { path: '/users/detail', component: './users/detail' },
        { path: '/users/:id', component: './users/id' }
      ]
    },
  ],
};
```
æ³¨æ„ï¼š**component æ˜¯ç›¸å¯¹äº src/pages ç›®å½•çš„**

## å¯ç”¨ Hash è·¯ç”±
**umi é»˜è®¤æ˜¯ç”¨çš„ Browser History**ï¼Œå¦‚æœè¦ç”¨ Hash Historyï¼Œéœ€é…ç½®ï¼š
``` js
export default {
  history: 'hash',
}
```
## é¡µé¢é—´è·³è½¬
åœ¨ umi é‡Œï¼Œé¡µé¢ä¹‹é—´è·³è½¬æœ‰ä¸¤ç§æ–¹å¼ï¼šå£°æ˜å¼å’Œå‘½ä»¤å¼ã€‚

### å£°æ˜å¼
åŸºäº umi/linkï¼Œé€šå¸¸ä½œä¸º React ç»„ä»¶ä½¿ç”¨ã€‚
``` js
import Link from 'umi/link';

export default () => (
  <Link to="/list">Go to list page</Link>
);
```
### å‘½ä»¤å¼
åŸºäº umi/routerï¼Œé€šå¸¸åœ¨äº‹ä»¶å¤„ç†ä¸­è¢«è°ƒç”¨ã€‚
``` js
import router from 'umi/router';

function goToListPage() {
  router.push('/list');
}
// å‘½ä»¤å¼è·¯ç”±çš„ä¼ å€¼æ–¹å¼
function goToHomePage() {
  router.push({
    pathname: '/home',
    query: {
        a: 'b',
    },
  })
}
```
### router.replace(path)
æ›¿æ¢å½“å‰é¡µé¢ï¼Œå‚æ•°å’Œ router.push() ç›¸åŒã€‚

### router.go(n)
å¾€å‰æˆ–å¾€åè·³æŒ‡å®šé¡µæ•°ã€‚

ä¾‹å­ï¼š
``` js
import router from 'umi/router';

router.go(-1);
router.go(2);
```
### router.goBack()
åé€€ä¸€é¡µã€‚

ä¾‹å­ï¼š
``` js
import router from 'umi/router';
router.goBack();
```
## HTML æ¨¡æ¿
### ä¿®æ”¹é»˜è®¤æ¨¡æ¿
æ–°å»º src/pages/document.ejsï¼Œumi çº¦å®šå¦‚æœè¿™ä¸ªæ–‡ä»¶å­˜åœ¨ï¼Œä¼šä½œä¸ºé»˜è®¤æ¨¡æ¿ï¼Œå†…å®¹ä¸Šéœ€è¦ä¿è¯æœ‰ `<div id="root"></div>`ï¼Œæ¯”å¦‚ï¼š
``` html
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Your App</title>
</head>
<body>
  <div id="root"></div>
</body>
</html>
```